# Data Model: RAG Backend System

## Entities

### Document
Represents a PDF file that has been parsed and indexed.

**Fields**:
- `id`: UUID - Unique identifier for the document
- `name`: String - User-provided name for the document collection
- `file_path`: String - Path to the original PDF file
- `indexed_at`: DateTime - Timestamp when document was indexed
- `chunk_count`: Integer - Number of chunks created from the document
- `status`: Enum - Indexing status (pending, processing, completed, failed)

**Relationships**:
- Has many Chunks

### Chunk
Represents a segment of document content with associated vector embedding and position information.

**Fields**:
- `id`: UUID - Unique identifier for the chunk
- `document_id`: UUID - Reference to parent document
- `content`: Text - The actual content of the chunk
- `position`: Integer - Position of chunk within document
- `metadata`: JSON - Additional chunk metadata (e.g., page number, section)
- `created_at`: DateTime - Timestamp when chunk was created

**Relationships**:
- Belongs to Document
- Has one Vector
- Connected to KnowledgeGraph nodes

### Vector
Numerical representation of chunk content generated by embedding model for similarity search.

**Fields**:
- `id`: UUID - Unique identifier for the vector
- `chunk_id`: UUID - Reference to parent chunk
- `embedding`: Array<Float> - Numerical vector representation
- `model_name`: String - Name of embedding model used
- `created_at`: DateTime - Timestamp when vector was generated

**Relationships**:
- Belongs to Chunk

### KnowledgeGraph
Entity relationship data extracted from chunks, stored as nodes and relationships in Memgraph.

**Nodes**:
- `EntityNode`:
  - `id`: UUID - Unique identifier
  - `name`: String - Name of the entity
  - `type`: String - Type/category of entity (person, organization, location, etc.)
  - `properties`: JSON - Additional entity properties

- `ConceptNode`:
  - `id`: UUID - Unique identifier
  - `name`: String - Name of the concept
  - `description`: Text - Description of the concept

**Relationships**:
- `EntityNode` -[RELATIONSHIP]-> `EntityNode`:
  - `type`: String - Type of relationship
  - `confidence`: Float - Confidence score of the relationship
  - `source_chunk_id`: UUID - Reference to originating chunk

- `Chunk` -[CONTAINS_ENTITY]-> `EntityNode`:
  - `mention_count`: Integer - Number of times entity appears in chunk

### Query
User question that may be expanded or processed before retrieval.

**Fields**:
- `id`: UUID - Unique identifier for the query
- `original_text`: Text - Original user query
- `expanded_text`: Text - Expanded query after preprocessing
- `timestamp`: DateTime - When query was received
- `user_id`: String - Identifier for user (optional)

### SearchResult
Retrieved document chunks with relevance scores and metadata.

**Fields**:
- `id`: UUID - Unique identifier for the search result
- `query_id`: UUID - Reference to originating query
- `chunk_id`: UUID - Reference to retrieved chunk
- `score`: Float - Relevance score
- `rank`: Integer - Rank in result set
- `retrieval_method`: String - Method used (vector, keyword, graph)

**Relationships**:
- Belongs to Query
- References Chunk

### Conversation
Series of related queries and responses with shared context.

**Fields**:
- `id`: UUID - Unique identifier for the conversation
- `session_id`: String - Identifier for user session
- `started_at`: DateTime - When conversation started
- `last_activity`: DateTime - When last activity occurred
- `context`: JSON - Shared context between queries

**Relationships**:
- Has many Queries
- Has many Responses

### Response
Generated answer to a user query.

**Fields**:
- `id`: UUID - Unique identifier for the response
- `query_id`: UUID - Reference to originating query
- `content`: Text - Generated response content
- `generated_at`: DateTime - When response was generated
- `model_used`: String - Name of LLM used
- `tokens_used`: Integer - Number of tokens consumed

**Relationships**:
- Belongs to Query
- Belongs to Conversation (through Query)