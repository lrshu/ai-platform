# Data Model for RAG Backend System

## Overview
The data model describes the entities and relationships stored in Memgraph for the RAG backend system.

## Entities

### Document
- **Name**: Document
- **Purpose**: Represents an indexed PDF document
- **Fields**:
  - document_name: String (user-provided name for the document)
  - document_id: String (unique identifier generated by the system)
  - created_at: DateTime (timestamp when the document was indexed)
  - file_path: String (original file path of the PDF)
  - page_count: Integer (number of pages in the PDF)
  - status: String (indexing status: "completed", "failed", "in_progress")
- **Relationships**:
  - HAS_CHUNK: Links to TextChunk entities

### TextChunk
- **Name**: TextChunk
- **Purpose**: Represents a portion of the document text
- **Fields**:
  - chunk_id: String (unique identifier generated by the system)
  - content: String (the text content of the chunk)
  - chunk_index: Integer (position of the chunk in the document)
  - embedding: Float List (vector embedding of the chunk)
  - metadata: Map (additional metadata: page number, character count, etc.)
- **Relationships**:
  - PART_OF: Links back to the Document entity
  - MENTIONS: Links to Entity entities mentioned in the chunk

### Entity
- **Name**: Entity
- **Purpose**: Represents a real-world object or concept extracted from text
- **Fields**:
  - entity_id: String (unique identifier generated by the system)
  - entity_name: String (name of the entity)
  - entity_type: String (type of the entity: "PERSON", "ORGANIZATION", "LOCATION", etc.)
  - metadata: Map (additional metadata: frequency, context examples, etc.)
- **Relationships**:
  - IS_MENTIONED_IN: Links back to TextChunk entities that mention the entity
  - RELATED_TO: Links to other Entity entities with specific relationships

### RelationshipType
- **Name**: RelationshipType
- **Purpose**: Represents the type of relationship between two entities
- **Fields**:
  - relationship_id: String (unique identifier generated by the system)
  - relationship_name: String (name of the relationship: "WORKS_AT", "LOCATED_IN", "AUTHOR_OF", etc.)
  - description: String (description of what the relationship means)
- **Relationships**:
  - DEFINES: Links to the RELATED_TO relationships between Entity entities

## Data Flow
1. PDF document is parsed into text
2. Text is split into TextChunk entities
3. Embeddings are generated for each TextChunk
4. Entities are extracted from TextChunk content
5. Relationships between entities are identified
6. All entities and relationships are stored in Memgraph

## Example Cypher Queries
### Create a Document with TextChunks
```cypher
CREATE (d:Document {document_id: 'doc123', document_name: 'rag_overview', created_at: datetime()})
CREATE (c1:TextChunk {chunk_id: 'chunk1', content: 'RAG systems combine retrieval and generation.', embedding: [0.1, 0.2, 0.3]})
CREATE (d)-[:HAS_CHUNK]->(c1)
```

### Find Entities Mentioned in a Document
```cypher
MATCH (d:Document {document_id: 'doc123'})-[:HAS_CHUNK]->(c:TextChunk)-[:MENTIONS]->(e:Entity)
RETURN e.entity_name, e.entity_type
```

### Perform Vector Similarity Search
```cypher
MATCH (c:TextChunk)
WHERE vector.similarity_cosine(c.embedding, [0.15, 0.25, 0.35]) > 0.8
RETURN c.content, c.chunk_id
```