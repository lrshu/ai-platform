这是一份基于您提供的文档内容整理的《规格驱动开发 (SDD)》中文白皮书/指南。我保留了原文的结构和核心术语，并进行了专业的意译，以确保符合技术语境。

---

# 规格驱动开发 (Specification-Driven Development, SDD)

## 权力反转 (The Power Inversion)

几十年来，代码一直是“王”。规格说明书（Specifications）只是为代码服务的——它们就像是我们搭建完就丢弃的脚手架，一旦“真正的编码工作”开始，它们就失去了价值。我们写 PRD 来指导开发，写设计文档来告知实现，画图表来可视化架构。但这些永远从属于代码。代码才是真理。其他一切，充其量只是美好的愿望。随着代码的迭代，规格说明书很少能跟上步伐。

**规格驱动开发 (SDD)** 颠覆了这种权力结构。规格不再服务于代码——**代码服务于规格**。产品需求文档 (PRD) 不再是实现的指南，而是生成的源头。技术计划不再是告知编码的文档，而是产生代码的精确定义。这不是对软件构建方式的增量改进，而是对驱动开发核心动力的根本性重新思考。

SDD 通过使规格及其衍生的具体实施计划变得**可执行**，从而消除了规格与实现之间的鸿沟。当规格和实施计划直接生成代码时，鸿沟就不复存在——只剩下转化。

这种转变之所以成为可能，是因为现在的 AI 能够理解并实现复杂的规格，并创建详细的实施计划。但没有结构的原始 AI 生成会产生混乱。SDD 通过提供结构化的规格和实施计划，确保其精确、完整且无歧义，足以生成工作系统。

在这个新世界里：

- **规格 (Specification)** 成为主要产物和真理的中心来源。
- **代码 (Code)** 成为规格在特定语言和框架中的表达（作为实施计划的产出）。
- **调试 (Debugging)** 意味着修复生成错误代码的规格和实施计划。
- **重构 (Refactoring)** 意味着为了清晰度而重组规格。

## SDD 工作流实践 (The Workflow)

工作流始于一个想法——通常是模糊和不完整的。通过与 AI 的迭代对话，这个想法变成了一个全面的 PRD。

1.  **交互式定义**：AI 提出澄清问题，识别边缘情况，并帮助定义精确的验收标准。传统开发中需要数天会议和文档的工作，现在只需数小时的专注规格制定。
2.  **动态更新**：当产品经理更新验收标准时，实施计划会自动标记受影响的技术决策。
3.  **研究代理 (Research Agents)**：在规格制定过程中，代理会自动收集关键背景信息（库兼容性、性能基准、安全性影响），并应用组织约束（数据库标准、部署策略）。
4.  **生成实施计划**：AI 从 PRD 生成将需求映射到技术决策的实施计划。每个技术选择都有记录在案的理由。
5.  **持续验证**：AI 持续分析规格中的歧义、矛盾和缺口，这不是一次性的关卡，而是持续的精炼过程。
6.  **代码生成**：一旦规格和计划足够稳定（不必完全“完成”），代码生成就开始了。早期生成可能是探索性的。
7.  **闭环反馈**：生产环境的指标和事故不仅仅触发热修复，它们会更新规格以进行下一次重新生成。

## 为什么现在需要 SDD？

三个趋势使 SDD 不仅成为可能，而且成为必要：

1.  **AI 能力的阈值**：AI 现在可以可靠地将自然语言规格转化为工作代码。这放大了开发者的效能，支持快速的“推倒重来”和模拟实验。
2.  **软件复杂性**：现代系统集成极其复杂。SDD 通过规格驱动的生成，提供系统性的对齐。
3.  **变化的速度**：需求变更（Pivot）现在是常态。在 SDD 中，当规格驱动实现时，转型变成了系统性的重新生成，而不是手动重写。

## 核心原则

- **规格作为通用语言 (Lingua Franca)**：规格是主要工件。维护软件意味着演进规格。
- **可执行的规格**：规格必须足够精确、完整且无歧义，以生成工作系统。
- **持续精炼**：一致性验证是持续进行的，AI 持续分析规格的歧义和缺口。
- **研究驱动的背景**：研究代理在规格过程中收集技术选项和组织约束。
- **双向反馈**：生产环境的现实情况（指标、事故）反哺规格的演进。
- **分支探索**：从同一规格生成多种实现方法，以探索不同的优化目标（性能、成本等）。

---

## 利用指令流线化 SDD (Streamlining with Commands)

SDD 方法论通过三个强大的指令得到显著增强，自动化了“规格 → 计划 → 任务”的工作流：

### 1. `/speckit.specify` 指令

将简单的功能描述转化为完整的、结构化的规格说明，并自动进行仓库管理：

- **自动编号**：扫描现有规格以确定下一个功能编号（如 001, 002）。
- **创建分支**：根据描述生成语义化的分支名称并自动创建。
- **基于模板生成**：复制并定制功能规格模板。
- **目录结构**：创建正确的 `specs/[branch-name]/` 结构。

### 2. `/speckit.plan` 指令

一旦功能规格存在，此指令创建全面的实施计划：

- **规格分析**：理解需求、用户故事和验收标准。
- **宪法合规**：确保与项目宪法和架构原则对齐。
- **技术转化**：将业务需求转化为技术架构。
- **详细文档**：生成数据模型、API 契约和测试场景的支持文档。
- **快速启动验证**：生成包含关键验证场景的 `quickstart.md`。

### 3. `/speckit.tasks` 指令

分析计划和设计文档以生成可执行的任务列表：

- **输入**：读取 `plan.md` 以及 `data-model.md`、`contracts/` 等。
- **任务推导**：将契约、实体和场景转化为具体任务。
- **并行化**：标记独立任务 `[P]` 并规划安全的并行组。
- **输出**：生成 `tasks.md`，供任务代理（Task Agent）执行。

---

## 模板驱动的质量：结构如何约束 LLM

这些指令的真正威力在于模板如何作为复杂的提示词（Prompt），约束 LLM 的行为以产出更高质量的结果：

1.  **防止过早陷入实现细节**：模板强制关注“用户需要什么(WHAT)和为什么(WHY)”，明确禁止“如何实现(HOW)”。
2.  **强制明确不确定性**：模板强制使用 `[NEEDS CLARIFICATION]` 标记，禁止 LLM 进行猜测。
3.  **通过清单进行结构化思考**：模板包含充当“单元测试”的清单，强制 LLM 自我审查（如：是否还有未澄清的标记？）。
4.  **通过关卡实现宪法合规**：实施计划包含“阶段关卡（Phase Gates）”，强制 LLM 证明其架构决策（如：是否引入了不必要的复杂性？）。
5.  **测试优先思维**：强制文件创建顺序：契约 -> 集成测试 -> E2E 测试 -> 单元测试 -> 源代码。

---

## 宪法基础：强制架构纪律 (The Constitutional Foundation)

SDD 的核心是一部**宪法 (`memory/constitution.md`)**——一套不可变的原则，治理规格如何变为代码。

### 开发九条 (The Nine Articles) 核心摘要：

- **第一条：库优先原则 (Library-First Principle)**
  - 每个功能必须首先作为一个独立的库存在。禁止在将其抽象为可重用组件之前直接在应用代码中实现。
- **第二条：CLI 接口强制 (CLI Interface Mandate)**
  - 每个库必须通过命令行接口暴露其功能（输入/输出均为文本/JSON）。这确立了可观测性。
- **第三条：测试优先指令 (Test-First Imperative)**
  - **不可协商**：所有实现必须遵循严格的 TDD。在单元测试编写、验证并确认为“失败（红）”状态之前，不得编写任何实现代码。
- **第七条 & 第八条：简单性与反抽象**
  - 最大化简单性，限制项目结构数量。直接使用框架特性，避免过度封装。
- **第九条：集成优先测试**
  - 测试必须使用现实环境（真实的数据库而非 Mock），确保生成的代码在实践中可行。

### 宪法的执行

实施计划模板通过具体的检查点（Gates）来操作化这些条款。例如，“简单性关卡”会询问：“是否使用了 ≤3 个项目？”如果 LLM 未能通过关卡，它必须在“复杂性跟踪”部分记录理由。

---

## 总结：转型 (The Transformation)

SDD 不是要取代开发者或自动化创造力。它是关于通过自动化机械转换来**放大人类能力**。它是关于创建一个紧密的反馈循环，在这个循环中，规格、研究和代码共同演进。

SDD 提供了一种方法论，通过**可执行的规格**（生成代码而不是仅仅指导代码），实现了意图与实现之间的完美对齐。

---

### 我们可以为您做的下一步

如果您希望开始尝试 SDD，我可以为您：

1.  **生成核心模板**：为您提供 `/speckit.specify` 和 `/speckit.plan` 所使用的 Markdown 模板结构，以便您在自己的项目中配置。
2.  **模拟 SDD 流程**：您可以给我一个简单的功能创意（例如“一个待办事项列表”），我扮演 SDD 系统，为您演示从 PRD 到 实施计划 再到 任务列表 的生成过程。

请问您想先进行哪一步？
