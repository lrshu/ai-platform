在使用 GitHub Spec Kit（Spec-Driven Development, SDD）开发过程中，如果项目创建后功能发生变化，核心原则是**“以规格说明书（Spec）为单一事实来源”**。

简单来说，你不能只改代码，而必须先改 Spec，然后让 Spec 驱动计划和任务的更新。以下是标准的处理流程：

### 核心流程：Spec → Plan → Tasks

当功能有变化（无论是新增功能还是修改现有逻辑）时，请遵循以下步骤：

#### 1. 更新规格说明书 (Update Spec)

不要直接去写代码或改代码。

- **交互式更新**：再次运行 `/specify` 命令（或 `/speckit.specify`），告诉 AI 新的需求变更。例如：“在用户登录模块中增加‘忘记密码’的功能”。AI 会帮助你修改或生成新的 Spec 文档。
- **手动修订**：你也可以直接进入 `.specify/specs/` 目录，找到对应的 Markdown 文件（通常是 PRD 或需求文档），手动修改业务逻辑和验收标准。

#### 2.以此重新生成计划 (Regenerate Plan)

Spec 变了，技术实现计划也必须跟着变。

- 运行 `/plan`（或 `/speckit.plan`）。
- AI 会读取更新后的 Spec，并检查当前的架构是否支持新功能。如果需要引入新的库、修改数据库 Schema 或调整 API，AI 会在技术计划（`.specify/planning/`）中体现出来。
- **注意**：这一步很重要，因为它可以帮你识别出新功能是否破坏了现有的架构原则（Constitution）。

#### 3. 重新生成/追加任务 (Update Tasks)

- 运行 `/tasks`（或 `/speckit.tasks`）。
- AI 会根据新的 Plan 对比当前状态，生成新的任务列表（Task List）。
- 它通常会生成一系列具体的 `.md` 任务文件（在 `.specify/planning/tasks/` 或类似目录下），指导你一步步实施变更。

#### 4. 执行代码变更 (Implement)

- 使用你的 AI 编程助手（如 GitHub Copilot, Cursor, Claude Code 等）读取新生成的任务文件。
- 让 AI 根据任务描述编写代码。

---

### 常见场景的处理技巧

#### 场景 A：新增一个独立的大功能（例如：增加后台管理面板）

建议把它当作一个新的 Spec 对待。

1.  运行 `/specify`，描述新模块。
2.  这通常会生成一个新的 Spec 文件，而不是覆盖旧的。
3.  后续流程同上（Plan -> Tasks）。

#### 场景 B：修改现有的小逻辑（例如：改变计费规则）

1.  直接编辑对应的 `.specify/specs/xxx.md` 文件。
2.  重新运行 `/plan` 确保没有遗漏的连锁反应（Side Effects）。
3.  让 AI 执行变更。

#### 场景 C：项目结构已经很复杂

Spec Kit 目前在“增量更新”方面还在完善中（社区有很多相关讨论）。

- **最佳实践**：如果项目很大，建议不要一次性重写所有 Plan。在运行 `/plan` 时，明确提示 AI **“仅针对 [新功能名称] 进行规划，保持其他架构不变”**。
- **保护 Constitution**：永远不要轻易覆盖 `.specify/memory/constitution.md`，这是项目的宪法（代码风格、核心原则），除非你的整个工程规范变了。

### 总结

在 Spec Kit 的体系下，**代码是 Spec 的衍生物**。
如果只改代码不改 Spec，你的文档和代码就会“漂移”（Drift），Spec Kit 的价值也就失去了。

**下一步建议：**
如果你正在面对一个具体的功能变更，可以告诉我变更的内容，我可以帮你草拟一个 `/specify` 的提示词（Prompt），让你直接发给 AI 使用。
